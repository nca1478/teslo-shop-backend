// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
    provider = "prisma-client-js"
}

datasource db {
    provider = "postgresql"
}

enum Size {
    XS
    S
    M
    L
    XL
    XXL
    XXXL
}

enum Gender {
    men
    women
    kids
    unisex
}

enum Role {
    admin
    user
}

model Category {
    id   String @id @default(uuid())
    name String @unique

    //Relaciones
    product Product[]

    @@map("category")
}

model Product {
    id          String   @id @default(uuid())
    title       String
    description String
    inStock     Int
    price       Float    @default(0)
    sizes       Size[]   @default([])
    slug        String   @unique
    tags        String[] @default([])
    gender      Gender

    //Relaciones
    Category   Category @relation(fields: [categoryId], references: [id])
    categoryId String

    ProductImage ProductImage[]
    OrderItem    OrderItem[]

    @@index([gender])
    @@map("product")
}

model ProductImage {
    id  Int    @id @default(autoincrement())
    url String

    //Relaciones
    product   Product @relation(fields: [productId], references: [id])
    productId String

    @@map("product_image")
}

model User {
    id            String    @id @default(uuid())
    name          String
    email         String    @unique
    emailVerified DateTime?
    password      String
    role          Role      @default(user)
    image         String?

    // relaciones
    UserAddress UserAddress?
    Order       Order[]

    @@map("user")
}

model Country {
    id   String @id
    name String

    // relaciones
    UserAddress  UserAddress[]
    OrderAddress OrderAddress[]

    @@map("country")
}

model UserAddress {
    id         String  @id @default(uuid())
    firstName  String
    lastName   String
    address    String
    address2   String?
    postalCode String
    phone      String
    city       String

    // relaciones
    country   Country @relation(fields: [countryId], references: [id])
    countryId String

    user   User   @relation(fields: [userId], references: [id])
    userId String @unique

    @@map("user_address")
}

model Order {
    id            String    @id @default(uuid())
    subTotal      Float
    tax           Float
    total         Float
    itemsInOrder  Int
    isPaid        Boolean   @default(false)
    paidAt        DateTime?
    createdAt     DateTime  @default(now())
    updatedAt     DateTime  @updatedAt
    transactionId String?

    //Relaciones
    user   User   @relation(fields: [userId], references: [id])
    userId String

    OrderItem    OrderItem[]
    OrderAddress OrderAddress?

    @@map("order")
}

model OrderItem {
    id       String @id @default(uuid())
    quantity Int
    price    Float
    size     Size

    // Relaciones
    order   Order  @relation(fields: [orderId], references: [id])
    orderId String

    product   Product @relation(fields: [productId], references: [id])
    productId String

    @@map("order_item")
}

model OrderAddress {
    id         String  @id @default(uuid())
    firstName  String
    lastName   String
    address    String
    address2   String?
    postalCode String
    city       String
    phone      String

    //Relaciones
    country   Country @relation(fields: [countryId], references: [id])
    countryId String

    Order   Order  @relation(fields: [orderId], references: [id])
    orderId String @unique

    @@map("order_address")
}
